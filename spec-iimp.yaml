goServer:
  outputDir: ./server/iimpserver
  packageName: iimpserver

goSdk:
  outputDir: ./sdk/iimp_go_client
  moduleName: github.com/iim-protocol/iimp/sdk/iimp_go_client

tsSdk:
  outputDir: ./sdk/iimp-ts-interface
  packageName: iimp-ts-interface
  description: TypeScript SDK for the IIMP Specification, providing type definitions and utilities for implementing the IIMP protocol in TypeScript applications.
  author: Naman B Gor <devnamangor@gmail.com>
  license: Apache-2.0
  repository: git+https://github.com/iim-protocol/iimp.git
  website: https://github.com/iim-protocol/iimp
  keywords:
    - IIMP
    - TypeScript
    - SDK
    - Interface
    - Protocol

schemas:
  ConversationParticipant: &conversationParticipant
    ConversationId:
      type: string
      description: The unique identifier of the conversation that the participant is part of. This is typically a UUIDv7.
      required: true
      nonEmpty: true
    UserId:
      type: string
      description: User ID of the participant. (localpart@domain)
      required: true
      nonEmpty: true
    UserDisplayName:
      type: string
      description: This is the display name of the participant at the time they joined the conversation. This is not updated if the user changes their display name later. This field is included to provide context about the participant's identity within the conversation, even if their global display name changes over time. During federation, the owner's server contacts the participant's server to fetch the current display name of the participant, which is then stored as UserDisplayName in the conversation participant list. This allows the conversation to maintain a consistent display name for the participant, even if they change their display name globally on their server.
      required: true
      nonEmpty: true
    JoinedAt:
      type: string
      description: The timestamp when the participant joined the conversation. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z").
      required: true
      nonEmpty: true
    RemovedAt:
      type: string
      description: The timestamp when the participant was removed from the conversation. This field is null if the participant is still part of the conversation. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z"). A removed participant will not receive new messages in the conversation but can still access the conversation history up until the time they were removed. Owner CANNOT be removed from the conversation.
      required: false
  Conversation: &conversation
    ConversationId:
      type: string
      description: A unique identifier for the conversation, typically a UUIDv7.
      required: true
      nonEmpty: true
    ConversationName:
      type: string
      description: An optional name for the conversation, which can be set by the client. This is not used for identification purposes and can be changed by the owner user at any time.
      required: false
    ConversationOwnerId:
      type: string
      description: The user ID of the owner of the conversation. (localpart@domain)
      required: true
      nonEmpty: true
    CreatedAt:
      type: string
      description: The timestamp when the conversation was created. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z").
      required: true
      nonEmpty: true
    Participants:
      type: array
      items:
        type: object
        description: A participant in the conversation.
        properties: *conversationParticipant
      description: A list of participants in the conversation. The owner of the conversation is also included in this list. Participants can be added or removed by the owner user. Contains at least 2 participants (including the owner) for a Direct Conversation and >2 participants for a Group Conversation.
      required: true
      nonEmpty: true
  UserEvent: &userEvent
    EventId:
      type: number
      description: A unique identifier for the event (Monotonically increasing per-user sequence number).
      required: true
    EventType:
      type: string
      description: The type of the event (e.g., "message_received", "conversation_created", etc.). This field can be used by the client to determine how to process the event. For a full list of event types and their corresponding payload structures, refer to the IIMP Client Events documentation [here](https://github.com/iim-protocol/iimp/tree/main/Events.md).
      required: true
      nonEmpty: true
    CreatedAt:
      type: string
      description: The timestamp when the event was created. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z").
      required: true
      nonEmpty: true
    Payload:
      type: object
      description: An optional field containing additional data related to the event. The structure of this object can vary depending on the event type and must conform to the IIMP Client Events documentation. Clients should be designed to handle different payload structures based on the event type.
      freeForm: true
  NewConversationRequestBody: &newConversationRequestBody
    description: Conversation details.
    properties:
      ConversationName:
        type: string
        description: A name for the conversation, which can be set by the client. This is not used for identification purposes and can be changed by the owner user at any time.
        required: false
      ParticipantUserIds:
        type: array
        items:
          type: string
          description: User ID of a participant to be added to the conversation. (localpart@domain)
        description: A list of user IDs for the participants to be added to the conversation. For a Direct Conversation, this list must contain exactly 2 user IDs (owner + participant). For a Group Conversation, this list must contain at least 3 user IDs (owner + 2 others).
        required: true
        nonEmpty: true
  NewConversationResponseBody: &newConversationResponseBody
    description: Conversation created successfully.
    properties:
      Conversation:
        description: Details of the created conversation.
        type: object
        properties: *conversation
  SyncEventsResponseBody: &syncEventsResponseBody
    description: A list of events and a cursor for the next page of results (if available, i.e. availableEvents > limit).
    properties:
      Events:
        description: A list of events for the authenticated user, if any available. The events are ordered by their EventId in Ascending Order. The server may return up to 'limit' events in the response. If there are more events available beyond the returned list, a 'next_cursor' field will be included in the response, which can be used to fetch the next page of results.
        type: array
        items:
          type: object
          description: A user facing event.
          properties: *userEvent
        required: true
      NextCursor:
        description: A cursor for the next page of results, if available. This field will be included in the response if there are more events available beyond the returned list.
        type: number
        required: false
  NewPublicKeyResponseBody: &newPublicKeyResponseBody
    description: Details of the added public key.
    properties:
      KeyId:
        type: string
        description: A unique identifier for the uploaded public key. This ID can be used to reference the key in future operations, such as encrypting messages for specific recipients or managing keys.
        required: true
        nonEmpty: true
      UploadedAt:
        type: string
        format: date-time
        description: The timestamp when the public key was uploaded to the server. This can be used to determine the age of the key and manage key rotation policies.
        required: true
  NewPublicKeyRequestBody: &newPublicKeyRequestBody
    description: Public key details.
    properties:
      PublicKey:
        type: string
        required: true
        nonEmpty: true
        description: The public key to be added for end-to-end encryption. The key should be Base64URL Encoded X25519 Key.
  RefreshSessionRequestBody: &refreshSessionRequestBody
    description: Refresh token details.
    properties:
      RefreshToken:
        type: string
        required: true
        nonEmpty: true
        description: A token used to refresh the session token when it expires.
  LoginRequestBody: &loginRequestBody
    description: User login credentials.
    properties:
      UserId:
        type: string
        required: true
        nonEmpty: true
        description: User ID for the account. (localpart@domain)
      Password:
        type: string
        required: true
        nonEmpty: true
        description: Password for the account.
  NewTokenOpsResponse: &newTokenOpsResponse
    description: Successful operation.
    properties:
      SessionToken:
        type: string
        description: A new token used to authenticate the client session. This token must be included in the header of subsequent requests to access protected resources.
        required: true
        nonEmpty: true
      RefreshToken:
        type: string
        description: A new token used to refresh the session token when it expires. Previous refresh tokens are invalidated when a new refresh token is issued.
        required: true
        nonEmpty: true
      SessionTokenExpiresIn:
        type: number
        description: The number of seconds until the session token expires.
        required: true
      RefreshTokenExpiresIn:
        type: number
        description: The number of seconds until the refresh token expires.
        required: true
  SignUpRequestBody: &signupRequestBody
    description: User registration details.
    properties:
      UserId:
        type: string
        required: true
        nonEmpty: true
        description: Desired user ID for the new account. (localpart@domain). Domain must be the same as the server's domain.
      Password:
        type: string
        required: true
        nonEmpty: true
        description: Password for the new account.
      DisplayName:
        type: string
        required: false
        description: Optional display name for the user.
      Email:
        type: string
        required: true
        nonEmpty: true
        description: Email address for the new account. This can be same as the user ID or a different email address. The email address will be used for account recovery.
  ResetPasswordRequestBody: &resetPasswordRequestBody
    description: New password details.
    properties:
      UserId:
        type: string
        required: true
        nonEmpty: true
        description: User ID for the account.
      NewPassword:
        type: string
        required: true
        nonEmpty: true
        description: New password for the account.
      ResetToken:
        type: string
        required: true
        nonEmpty: true
        description: A token sent to the user's email address as part of the password reset process. This token is used to verify the password reset request.
  Attachment: &attachment
    AttachmentId:
      type: string
      required: true
      nonEmpty: true
      description: A unique identifier for the attachment, typically a UUIDv7. Sender's server generates this ID when the attachment is uploaded and returns it to the sender client, which then includes it in the message payload when sending a message with attachments. The server will store the attachment and deliver it to the recipients along with the message content.
    Filename:
      type: string
      required: true
      nonEmpty: true
      description: The original filename of the attachment.
    ContentType:
      type: string
      required: true
      nonEmpty: true
      description: The MIME type of the attachment (e.g., "image/png", "application/pdf", etc.).
    Size:
      type: number
      required: true
      description: The size of the attachment in bytes. The server may enforce a maximum attachment size
  MessageEncryptionDetails: &messageEncryptionDetails
    KeyId:
      type: string
      required: true
      nonEmpty: true
      description: The unique identifier of the public key that was used to encrypt the message for this recipient. This should correspond to a KeyId returned by the server when the client added their public keys.
    EncryptedKey:
      type: string
      required: true
      nonEmpty: true
      description: The AES key used to encrypt the message content, encrypted with the recipient's public key using an asymmetric encryption algorithm (X25519 + HKDF). The server will store this encrypted key and deliver it to the recipient along with the encrypted message content, allowing the recipient to decrypt the AES key using their private key and then use it to decrypt the message content.
    EphemeralPublicKey:
      type: string
      required: true
      nonEmpty: true
      description: An ephemeral public key generated by the sender for this message, used in the encryption process (X25519).
    EncryptedKeyNonce:
      type: string
      required: true
      nonEmpty: true
      description: The nonce used in the encryption of the AES key for this recipient. This should be a unique value for each encrypted key to ensure security. The server will store this nonce along with the encrypted key and deliver it to the recipient, allowing them to use it in the decryption process. The nonce should be generated securely (e.g., using a cryptographically secure random number generator) and should be of 12 bytes (96 bits) in length for AES-256-GCM encryption.
  MessageContent: &messageContent
    Content:
      type: string
      required: true
      nonEmpty: true
      description: The content of the message to be sent in the conversation. The content should be encrypted using an AES key, and the AES key should be encrypted for each recipient using their respective public keys. The server will store the encrypted message content and the encrypted keys for each recipient, allowing the recipients to decrypt the AES key using their private keys and then use it to decrypt the message content.
    Nonce:
      type: string
      required: true
      nonEmpty: true
      description: The nonce (or initialization vector) used in the AES encryption of the message content. This should be a unique value for each message encrypted with the same AES key to ensure security. The nonce is required for the decryption process, as it is used along with the AES key to decrypt the message content. The server will store the nonce along with the encrypted message content and deliver it to the recipients, allowing them to use it in the decryption process. The nonce should be generated securely (e.g., using a cryptographically secure random number generator) and should be of 12 bytes (96 bits) in length for AES-256-GCM encryption.
    EncryptionData:
      type: array
      required: true
      nonEmpty: true
      description: Encryption details for the recipients of the message.
      items:
        type: object
        description: Encryption details for the recipients of the message.
        properties:
          RecipientId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the recipient of the message. (localpart@domain). This field is included to associate the encryption details with the specific recipient, allowing the server to deliver the correct encrypted key and nonce to each recipient along with the encrypted message content.
          Encryption:
            description: Encryption details for a recipient of the message.
            type: object
            required: true
            properties: *messageEncryptionDetails
    Timestamp:
      type: string
      required: true
      nonEmpty: true
      description: The timestamp when the message content was created. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z"). This field is included to provide context about when the message content was created, which can be useful for ordering messages and displaying timestamps in the client applications.
  Message: &message
    MessageId:
      type: string
      required: true
      nonEmpty: true
      description: A unique identifier for the message, typically a UUIDv7.
    ConversationId:
      type: string
      required: true
      nonEmpty: true
      description: The unique identifier of the conversation that the message belongs to. This is typically a UUIDv7.
    Contents:
      type: array
      required: true
      nonEmpty: true
      description: A list of message contents for the message, ordered by their version in Ascending Order. The original message sent by the client will have version 1. Each time the message is edited, a new MessageContent object is added to this list with the version number incremented by 1. This allows the server and clients to maintain a history of edits for each message, enabling features such as edit history viewing and audit trails.
      items:
        type: object
        description: A message content for the message.
        properties:
          Version:
            type: number
            required: true
            description: The version of the message, to support message editing. The original message sent by the client will have version 1. Each time the message is edited, a new MessageContent object is added in the contents array with the version number incremented by 1. This allows the server and clients to maintain a history of edits for each message, enabling features such as edit history viewing and audit trails.
          MessageContent:
            type: object
            required: true
            properties: *messageContent
    IsRedacted:
      type: boolean
      required: true
      description: A flag indicating whether the message has been redacted. Redaction is the process of removing or obscuring the content of a message while retaining its metadata (e.g., sender, timestamp) for record-keeping purposes. A redacted message will have its content removed or replaced with a placeholder value, and the IsRedacted flag will be set to true.
    Timestamp:
      type: string
      required: true
      nonEmpty: true
      description: The timestamp when the message was originally sent. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z"). This field is included to provide context about when the message was sent, which can be useful for ordering messages and displaying timestamps in the client applications.
    Attachments:
      type: array
      description: An optional list of attachments included with the message. Each attachment can be a file, image, or other media type that is associated with the message. The server will store the attachments and deliver them to the recipients along with the message content.
      required: false
      items:
        type: string
        description: The AttachmentId of an attachment included with the message.
        required: true
        nonEmpty: true
    SenderUserId:
      type: string
      required: true
      nonEmpty: true
      description: User ID of the sender of the message. (localpart@domain)
    UserSpecificData:
      type: array
      description: An array of per-user data for each recipient of the message.
      required: true
      nonEmpty: true
      items:
        type: object
        description: Per-user data for a recipient of the message.
        properties:
          RecipientId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the recipient of the message. (localpart@domain)
          ReadAt:
            type: string
            description: The timestamp when the recipient read the message. This field is null if the recipient has not read the message yet. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z"). This field is included to provide read receipt functionality, allowing the sender to know when each recipient has read the message.
          Reaction:
            type: string
            description: An optional reaction from the recipient for the message (e.g., "like", "love", "laugh", "sad", "angry", etc.). This field is included to provide message reaction functionality, allowing recipients to react to messages with predefined reactions. The server will store the reaction and deliver it to the sender and other recipients, allowing them to see the reactions for each message. Emoji-Only field.
          ReactedAt:
            type: string
            description: The timestamp when the recipient reacted to the message. This field is null if the recipient has not reacted to the message yet. Format => ISO 8601 (e.g., "2024-06-01T12:00:00Z"). This field is included to provide context about when each reaction was made for the message.
  NewMessageRequestBody: &newMessageRequestBody
    MessageContent:
      description: The content of the message to be sent in the conversation. The content should be encrypted using an AES key, and the AES key should be encrypted for each recipient using their respective public keys. The server will store the encrypted message content and the encrypted keys for each recipient, allowing the recipients to decrypt the AES key using their private keys and then use it to decrypt the message content.
      type: object
      required: true
      properties: *messageContent
    Attachments:
      type: array
      description: An optional list of attachments to be included with the message. Each attachment can be a file, image, or other media type that is associated with the message. The server will store the attachments and deliver them to the recipients along with the message content.
      items:
        type: string
        description: The AttachmentId of an attachment to be included with the message. The AttachmentId should correspond to an attachment that was previously uploaded to the server using the NewAttachment endpoint, which returns the AttachmentId in the response. The client should include the AttachmentId in the message payload when sending a message with attachments, allowing the server to associate the attachments with the message and deliver them to the recipients along with the message content.
        required: true
        nonEmpty: true
  NewMessageResponseBody: &newMessageResponseBody
    description: Message sent successfully.
    properties:
      MessageId:
        type: string
        description: A unique identifier for the message, typically a UUIDv7.
        required: true
        nonEmpty: true
  EditMessageRequestBody: &editMessageRequestBody
    MessageContent:
      type: object
      required: true
      properties: *messageContent
  UpdateConversationRequestBody: &updateConversationRequestBody
    description: Updated conversation details.
    properties:
      ConversationName:
        type: string
        description: An updated name for the conversation, which can be set by the client. This is not used for identification purposes and can be changed by the owner user at any time.
        required: false
      ParticipantUserIdsToAdd:
        type: array
        items:
          type: string
          description: User ID of a participant to be added to the conversation. (localpart@domain)
        description: A list of user IDs for the participants to be added to the conversation.
        required: false
      ParticipantUserIdsToRemove:
        type: array
        items:
          type: string
          description: User ID of a participant to be removed from the conversation. (localpart@domain)
        description: A list of user IDs for the participants to be removed from the conversation. The owner user cannot be removed from the conversation and should not be included in this list.
        required: false
  UpdateConversationResponseBody: &updateConversationResponseBody
    description: Conversation updated successfully.
    properties:
      Conversation:
        description: Details of the updated conversation.
        type: object
        properties: *conversation
  ReactToMessageRequestBody: &reactToMessageRequestBody
    Reaction:
      type: string
      description: A reaction from the recipient of a message (e.g., "like", "love", "laugh", "sad", "angry", etc.). Emoji-Only field. Null to remove reaction.
      required: false

  # Discovery Models
  ServerInfo: &serverInfo
    type: object
    description: Information about the IIMP server, including protocol version, domain, and federation endpoint.
    properties:
      Version:
        type: string
        required: true
        nonEmpty: true
        description: IIMP protocol version supported by the server.
      Domain:
        type: string
        required: true
        nonEmpty: true
        description: Canonical domain name of the server.
      FederationEndpoint:
        type: string
        required: true
        nonEmpty: true
        description: URL endpoint for federation with other IIMP servers.
  UserPublicKey: &userPublicKey
    type: object
    description: Information about a user's public key, including its identifier, upload timestamp, associated user ID, and the public key data itself.
    properties:
      KeyId:
        type: string
        required: true
        nonEmpty: true
        description: Unique identifier for the public key.
      UploadedAt:
        type: string
        required: true
        nonEmpty: true
        description: Timestamp indicating when the public key was uploaded, in ISO 8601 format.
      UserId:
        type: string
        required: true
        nonEmpty: true
        description: Unique identifier of the user to whom the public key belongs. (localpart@domain)
      PublicKey:
        type: string
        required: true
        nonEmpty: true
        description: The actual public key data, encoded in a suitable format (X25519 public key encoded in Base64URL format).
  JWKSResponse: &jwksResponse
    description: A JSON Web Key Set (JWKS) containing the public keys used by the server for verifying signatures. This is used in the federation process to ensure secure communication between servers. RFC 7517 compliant response format.
    type: object
    properties:
      Keys:
        type: array
        required: true
        nonEmpty: true
        description: A list of JSON Web Keys (JWK) used to verify signatures issued by this server.
        items:
          type: object
          required: true
          properties:
            Kid:
              type: string
              required: true
              nonEmpty: true
              description: Unique identifier for the key. Used to match the 'kid' field in JWT headers.
            Kty:
              type: string
              required: true
              nonEmpty: true
              description: The key type. For example, "RSA" or "OKP".
            Use:
              type: string
              required: true
              nonEmpty: true
              description: The intended use of the key. Typically "sig" for signature verification.
            Alg:
              type: string
              required: true
              nonEmpty: true
              description: The algorithm used with this key. For example, "RS256" or "EdDSA".
            N:
              type: string
              required: false
              description: RSA modulus (base64url encoded). Required if Kty is "RSA".
            E:
              type: string
              required: false
              description: RSA public exponent (base64url encoded). Required if Kty is "RSA".
            Crv:
              type: string
              required: false
              description: Elliptic curve name (e.g., "Ed25519" or "X25519"). Required if Kty is "OKP".
            X:
              type: string
              required: false
              description: Public key value (base64url encoded). Required if Kty is "OKP".

  # Federation Models
  FederationUserInfo: &federationUserInfo
    UserId:
      type: string
      required: true
      nonEmpty: true
      description: User ID of the user. (localpart@domain)
    DisplayName:
      type: string
      required: true
      nonEmpty: true
      description: Display name of the user.

spec:
  name: Internet Instant Messaging Protocol (IIMP) Specification
  apiName: IIMP
  description: A protocol for real-time communication over the internet, enabling users to exchange messages, share files, and engage in group chats. This specification provides the core interfaces and data models for implementing the IIMP protocol, which can be used for both server and client implementations.
  version: 0.0.1
  website: https://github.com/iim-protocol/iimp
  license: Apache-2.0

  auth:
    - id: sessionToken
      type: header
      name: Authorization
      transportName: Authorization
      format: "Bearer <JWT (RFC 7519)>"
      description: A token used to authenticate the client session. This token is obtained after a successful login and must be included in the header of subsequent requests to access protected resources.

    - id: serverToken
      type: header
      name: Authorization
      transportName: Authorization
      format: "Bearer <JWT (RFC 7519)>"
      description: Server JWT signed with the requesting server's private key. This token is used for authenticating requests between servers during federation. The receiving server will verify the token using the requesting server's public key, which can be obtained from the requesting server's JWKS endpoint.

  endpoints:
    SignUp:
      path: /api/client/signup
      method: POST
      description: Register a new user account with the IIMP service.
      requestBody: *signupRequestBody
      responses:
        201:
          description: Account created successfully. No user_id is returned in the response body. The client should use the user_id from the request for subsequent operations.
        400:
          description: Invalid input data.
        409:
          description: User ID already exists.
        500:
          description: Internal server error.

    Login:
      path: /api/client/login
      method: POST
      description: Authenticate a user and establish a session.
      requestBody: *loginRequestBody
      responses:
        200: *newTokenOpsResponse
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. Invalid user ID or password.
        500:
          description: Internal server error.

    Logout:
      path: /api/client/logout
      method: POST
      description: Log out the current user and invalidate the session.
      auth:
        all:
          - sessionToken
      responses:
        204:
          description: Logout successful. The session token is invalidated.
        401:
          description: Unauthorized. No valid session token provided.
        500:
          description: Internal server error.

    RefreshSession:
      path: /api/client/refresh-session
      method: POST
      description: Refresh the session token.
      requestBody: *refreshSessionRequestBody
      responses:
        200: *newTokenOpsResponse
        401:
          description: Unauthorized. No valid refresh token provided.
        500:
          description: Internal server error.

    RequestResetPassword:
      path: /api/client/request-reset-password
      method: POST
      description: Request a password reset for the user account.
      requestBody:
        description: User ID for the account to reset the password.
        properties:
          UserId:
            type: string
            required: true
            nonEmpty: true
            description: User ID for the account.
      responses:
        200:
          description: Password reset requested successfully. An email with reset instructions will be sent to the user's registered email address if the user ID exists. For security reasons, the response is the same regardless of whether the user ID exists or not.
        400:
          description: Invalid input data.
        500:
          description: Internal server error.

    ResetPassword:
      path: /api/client/reset-password
      method: POST
      description: Reset the password for the user account.
      requestBody: *resetPasswordRequestBody
      responses:
        200:
          description: Password reset successfully.
        401:
          description: Invalid or expired reset token or input data.
        500:
          description: Internal server error.

    AddPublicKey:
      path: /api/client/keys
      method: POST
      description: Add a new public key for end-to-end encryption.
      auth:
        all:
          - sessionToken
      requestBody: *newPublicKeyRequestBody
      responses:
        201:
          description: Public key added successfully.
          body: *newPublicKeyResponseBody
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        500:
          description: Internal server error.

    NewConversation:
      path: /api/client/conversations
      method: POST
      description: Create a new conversation.
      auth:
        all:
          - sessionToken
      requestBody: *newConversationRequestBody
      responses:
        201:
          description: Conversation created successfully.
          body: *newConversationResponseBody
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. One or more user IDs in the participant list are not allowed to be added to the conversation.
        404:
          description: One or more user IDs in the participant list do not exist.
        500:
          description: Internal server error.

    SyncUserEvents:
      path: /api/client/events/sync
      method: GET
      description: Fetch a list of events for the authenticated user.
      auth:
        all:
          - sessionToken
      queryParams:
        - name: Cursor
          transportName: cursor
          type: number
          required: false
          description: A cursor (Monotonically increasing per-user sequence number) for pagination. The server will return events starting from this cursor. If not provided, the server will return all available events starting from the oldest event in the system. The response will include a next_cursor field that can be used to fetch the next page of results.
        - name: Limit
          transportName: limit
          type: number
          required: false
          description: The maximum number of events to return in the response. If not provided, the server will use a default limit (e.g., 50). The server may enforce a maximum limit (100) to prevent excessively large responses.
      responses:
        200:
          description: Events fetched successfully.
          body: *syncEventsResponseBody
        401:
          description: Unauthorized. No valid session token provided.
        500:
          description: Internal server error.
    NewMessage:
      path: /api/client/conversations/{conversationId}/messages
      method: POST
      description: Send a new message in a conversation.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: The unique identifier of the conversation to send the message in. This is typically a UUIDv7.
      requestBody:
        description: Message details.
        properties: *newMessageRequestBody
      responses:
        201:
          description: Message sent successfully.
          body: *newMessageResponseBody
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not a participant in the conversation.
        404:
          description: Conversation not found.
        500:
          description: Internal server error.
    EditMessage:
      path: /api/client/conversations/{conversationId}/messages/{messageId}
      method: PUT
      description: Edit an existing message in a conversation. Only the sender of the message can edit it.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: The unique identifier of the conversation that the message belongs to. This is typically a UUIDv7.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: The unique identifier of the message to edit. This is typically a UUIDv7
      requestBody:
        description: Updated message details. Attachments CANNOT BE UPDATED!!!
        properties: *editMessageRequestBody
      responses:
        200:
          description: Message edited successfully.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not the sender of the message or is not a participant in the conversation.
        404:
          description: Conversation or message not found or Message not in the conversation id specified.
        500:
          description: Internal server error.
    RedactMessage:
      path: /api/client/conversations/{conversationId}/messages/{messageId}/redact
      method: POST
      description: Redact a message in a conversation. If this conversation is a Direct Conversation, only the sender of the message can redact it. If this conversation is a Group Conversation, only the sender of the message or the owner of the conversation can redact it.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: The unique identifier of the conversation that the message belongs to. This is typically a UUIDv7.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: The unique identifier of the message to redact. This is typically a UUIDv7.
      responses:
        200:
          description: Message redacted successfully.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not the sender of the message or the owner of the conversation.
        404:
          description: Conversation or message not found.
        500:
          description: Internal server error.
    UpdateConversation:
      path: /api/client/conversations/{conversationId}
      method: PUT
      description: Update an existing conversation. Only for Group Conversations, Direct Conversations cannot be updated.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: The unique identifier of the conversation to update. This is typically a UUIDv7.
      requestBody: *updateConversationRequestBody
      responses:
        200:
          description: Conversation updated successfully.
          body: *updateConversationResponseBody
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not allowed to update the conversation since they are not the owner of the conversation or the conversation is a Direct Conversation.
        404:
          description: Conversation not found.
        500:
          description: Internal server error.
    ReadMessage:
      path: /api/client/conversations/{conversationId}/messages/{messageId}/read
      method: POST
      description: Mark a message as read by the authenticated user.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: The unique identifier of the conversation that the message belongs to. This is typically a UUIDv7.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: The unique identifier of the message to mark as read. This is typically a UUIDv7.
      responses:
        200:
          description: Message marked as read successfully.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not a participant in the conversation or is not a recipient of the message.
        404:
          description: Conversation or message not found or Message not in the conversation id specified.
        500:
          description: Internal server error.
    ReactToMessage:
      path: /api/client/conversations/{conversationId}/messages/{messageId}/react
      method: POST
      description: React to a message in a conversation.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          nonEmpty: true
          description: The unique identifier of the conversation that the message belongs to. This is typically a UUIDv7.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          nonEmpty: true
          description: The unique identifier of the message to react to. This is typically a UUIDv7.
      requestBody:
        description: Reaction details.
        properties: *reactToMessageRequestBody
      responses:
        200:
          description: Message reacted to successfully.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not a participant in the conversation or is not a recipient of the message.
        404:
          description: Conversation or message not found or Message not in the conversation id specified.
        500:
          description: Internal server error.
    NewAttachment:
      path: /api/client/attachments
      method: POST
      description: Upload an attachment to be included with a message.
      auth:
        all:
          - sessionToken
      requestBody:
        description: Attachment details.
        properties:
          Filename:
            type: string
            required: true
            nonEmpty: true
            description: The original filename of the attachment.
          ContentType:
            type: string
            required: true
            nonEmpty: true
            description: The MIME type of the attachment (e.g., "image/png", "application/pdf", etc.).
          Size:
            type: number
            required: true
            description: The size of the attachment in bytes. The server may enforce a maximum attachment size.
      responses:
        201:
          description: Attachment uploaded successfully.
          body:
            description: Details of the uploaded attachment.
            properties:
              AttachmentId:
                type: string
                required: true
                nonEmpty: true
                description: A unique identifier for the attachment, typically a UUIDv7. This ID can be used to reference the attachment in future operations, such as including it in a message payload when sending a message with attachments. The server will store the attachment and deliver it to the recipients along with the message content.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        413:
          description: Payload too large. The specified size exceeds the allowed maximum attachment size. This size limit is set by the protocol at 1000MB.
        500:
          description: Internal server error.
    UploadAttachment:
      path: /api/client/attachments/{attachmentId}/bytes
      method: PUT
      description: Upload the bytes of an attachment. The bytes go in the request body.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: AttachmentId
          transportName: attachmentId
          type: string
          required: true
      responses:
        204:
          description: Attachment uploaded successfully.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not allowed to upload the attachment.
        404:
          description: Attachment not found.
        409:
          description: Conflict. The attachment bytes have already been uploaded for the specified AttachmentId.
        413:
          description: Payload too large. The upload exceeds the allowed size for the attachment OR the attachment is too large (This size limit is set by the protocol at 1000MB).
          body:
            description: Details of the error.
            properties:
              AttachmentSize:
                type: number
                required: true
                description: The total size of the attachment specified during creation in bytes.
        500:
          description: Internal server error.

    FetchAttachmentBytes:
      path: /api/client/conversations/{conversationId}/messages/{messageId}/attachments/{attachmentId}/bytes
      method: GET
      description: Fetch the bytes of an attachment for a message in a conversation. This is a NOOP endpoint for documentation, since the actual fetching of the attachment bytes is to be done by the client.
      auth:
        all:
          - sessionToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: The unique identifier of the conversation that the message belongs to. This is typically a UUIDv7.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: The unique identifier of the message that the attachment belongs to. This is typically a UUIDv7.
        - name: AttachmentId
          transportName: attachmentId
          type: string
          required: true
          description: The unique identifier of the attachment to fetch. This is typically a UUIDv7 and should correspond to an attachment that was previously uploaded to the server using the NewAttachment endpoint.
      responses:
        200:
          description: Attachment bytes fetched successfully. The response body will contain the raw bytes of the attachment, and the Content-Type header will indicate the MIME type of the attachment (e.g., "image/png", "application/pdf", etc.). The client can use this information to handle the attachment appropriately (e.g., display an image, prompt for download, etc.).
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid session token provided.
        403:
          description: Forbidden. The authenticated user is not a participant in the conversation or is not a recipient of the message or is not allowed to access the attachment.
        404:
          description: Conversation, message, or attachment not found or Attachment not in the message id or conversation id specified.
        500:
          description: Internal server error.

    # Discovery Endpoints
    DiscoverServer:
      path: /.well-known/iimp
      method: GET
      description: Retrieve information about the IIMP server, including protocol version, domain, and federation endpoint. This allows clients and other servers to discover the capabilities and federation details of the server.
      responses:
        200:
          description: Successful retrieval of the server information. RFC8615 compliant response containing the server's protocol version, domain, and federation endpoint.
          body: *serverInfo
        500:
          description: Internal server error while retrieving the server information.

    GetJWKSStore:
      path: /.well-known/iimp/jwks
      method: GET
      description: Retrieve the JSON Web Key Set (JWKS) containing the public keys used by the server for verifying signatures. This is used in the federation process to ensure secure communication between servers.
      responses:
        200:
          description: Successful retrieval of the JWKS information. RFC7517 compliant response containing the public keys used for signature verification.
          body: *jwksResponse
        500:
          description: Internal server error while retrieving the JWKS information.

    GetUserPublicKey:
      path: /.well-known/iimp/keys/users/{userId}
      method: GET
      description: Retrieve the public key associated with a specific user.
      pathParams:
        - name: UserId
          transportName: userId
          type: string
          required: true
          description: Unique identifier of the user whose public key is being requested. This should be in the format localpart@domain.
      responses:
        200:
          description: Successful retrieval of the user's public key information.
          body: *userPublicKey
        404:
          description: No public key found for the specified user or the user does not exist.
        500:
          description: Internal server error while retrieving the user's public key information.

    GetUserPublicKeyById:
      path: /.well-known/iimp/keys/users/{userId}/{keyId}
      method: GET
      description: Retrieve a specific public key associated with a user, identified by its key ID. Used for historical key retrieval.
      pathParams:
        - name: UserId
          transportName: userId
          type: string
          required: true
          description: Unique identifier of the user whose public key is being requested. This should be in the format localpart@domain.
        - name: KeyId
          transportName: keyId
          type: string
          required: true
          description: Unique identifier for the specific public key to retrieve. This allows clients to fetch historical keys if needed.
      responses:
        200:
          description: Successful retrieval of the user's public key information.
          body: *userPublicKey
        404:
          description: No public key found for the specified user and key ID or the user does not exist.
        500:
          description: Internal server error while retrieving the user's public key information.

    # Federation Endpoints
    GetUserInfoFederation:
      path: /api/federation/users/{userId}
      method: GET
      description: \"FEDERATION\" Retrieve information about a user for federation purposes. This endpoint is used by other servers to fetch details about a user, such as their display name and more.
      auth:
        all:
          - serverToken
      pathParams:
        - name: UserId
          transportName: userId
          type: string
          required: true
          description: Unique identifier of the user whose information is being requested. This should be in the format localpart@domain.
      responses:
        200:
          description: Successful retrieval of the user's information for federation purposes.
          body:
            description: User info required for federation.
            properties: *federationUserInfo
        401:
          description: Unauthorized. No valid server token provided.
        404:
          description: User not found.
        500:
          description: Internal server error while retrieving the user's information.

    ConversationFederation:
      path: /api/federation/conversations
      method: POST
      description: \"FEDERATION\" Create/Update a conversation from another server. This endpoint is used by other servers to create/update a conversation that includes users from the local server. UPSERT operation should be performed by the receiving server.
      auth:
        all:
          - serverToken
      requestBody:
        description: Conversation details for federation. The full model is pushed since all computations and mutations are done by the requesting server, the receiving server just needs to store the conversation and its details as is.
        properties: *conversation
      responses:
        200:
          description: Conversation stored/updated successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != conversation owner id domain).
        404:
          description: No user IDs in the participant list exist on the receiving server.
        500:
          description: Internal server error while creating the conversation from federation request.

    MessageFederation:
      path: /api/federation/conversations/{conversationId}/messages
      method: POST
      description: \"FEDERATION\" Send a new message/update to an existing message model to a conversation from another server. This endpoint is used by other servers to send messages to a conversation that includes users from the local server. The request will include details about the message and its sender. Upsert operation must be performed by the receiving server.
      auth:
        all:
          - serverToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation to send the message to.
      requestBody:
        description: Message details for federation. The full model is pushed since all computations and mutations are done by the requesting server, the receiving server just needs to store the message and its details as is.
        properties: *message
      responses:
        200:
          description: Message stored/updated successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != conversation owner id domain).
        404:
          description: Conversation not found.
        500:
          description: Internal server error while sending the message from federation request.

    MessageForwardFederation:
      path: /api/federation/conversations/{conversationId}/messages/forward
      method: POST
      description: \"FEDERATION\" Forward an existing message to a conversation from another server.
      auth:
        all:
          - serverToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation to forward the message to.
      requestBody:
        description: Message forwarding details for federation.
        properties:
          OriginalMessageRequest:
            description: Message details.
            type: object
            required: true
            properties: *newMessageRequestBody
          SenderUserId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the sender of the forwarded message. This should be in the format localpart@domain and must belong to the requesting server.
      responses:
        200:
          description: Message forwarded successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != SenderUserId domain) or SenderUserId does not belong to the requesting server, OR the receiving server is not the conversation owner's server.
        404:
          description: Conversation not found or Sender User Id not a participant.
        500:
          description: Internal server error while forwarding the message from federation request.

    RedactMessageForwardFederation:
      path: /api/federation/conversations/{conversationId}/messages/{messageId}/redact/forward
      method: POST
      description: \"FEDERATION\" Redact a message in a conversation on another server.
      auth:
        all:
          - serverToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation to redact the message in.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: Unique identifier of the message to redact.
      requestBody:
        description: Message redaction details for federation.
        properties:
          SenderUserId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the sender of the message to redact. This should be in the format localpart@domain and must belong to the requesting server and should be equal to the sender's id on the receiving server's message.
      responses:
        200:
          description: Message redacted successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != sender id domain), or user does not have permission to redact the message, or Receiving server is not conversation owner's server.
        404:
          description: Conversation or message not found.
        500:
          description: Internal server error while redacting the message from federation request.

    ReactToMessageForwardFederation:
      path: /api/federation/conversations/{conversationId}/messages/{messageId}/react/forward
      method: POST
      description: \"FEDERATION\" React to a message in a conversation on another server.
      auth:
        all:
          - serverToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation to react to the message in.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: Unique identifier of the message to react to.
      requestBody:
        description: Reaction details for federation.
        properties:
          OriginalReaction:
            type: object
            description: Original received reaction on the requesting server.
            properties: *reactToMessageRequestBody
          ReactingUserId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the user who made the reaction. This should be in the format localpart@domain and must belong to the requesting server.
      responses:
        200:
          description: Message reacted to successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != ReactingUserId domain) or ReactingUserId does not belong to the requesting server, OR the receiving server is not the conversation owner's server.
        404:
          description: Conversation or message not found.
        500:
          description: Internal server error while reacting to the message from federation request.

    ReadMessageForwardFederation:
      path: /api/federation/conversations/{conversationId}/messages/{messageId}/read/forward
      method: POST
      description: \"FEDERATION\" Mark a message as read in a conversation on another server.
      auth:
        all:
          - serverToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation to mark the message as read in.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: Unique identifier of the message to mark as read.
      requestBody:
        description: Read message details for federation.
        properties:
          ReaderUserId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the user who read the message. This should be in the format localpart@domain and must belong to the requesting server.
      responses:
        200:
          description: Message marked as read successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != ReaderUserId domain) or ReaderUserId does not belong to the requesting server, OR the receiving server is not the conversation owner's server.
        404:
          description: Conversation or message not found.
        500:
          description: Internal server error while marking the message as read from federation requested.

    EditMessageForwardFederation:
      path: /api/federation/conversations/{conversationId}/messages/{messageId}/edit/forward
      method: PUT
      description: \"FEDERATION\" Edit a message in a conversation on another server.
      auth:
        all:
          - serverToken
      pathParams:
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation to edit the message in.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: Unique identifier of the message to edit.
      requestBody:
        description: Message editing details for federation.
        properties:
          SenderUserId:
            type: string
            required: true
            nonEmpty: true
            description: User ID of the sender of the message to edit. This should be in the format localpart@domain and must belong to the requesting server and should be equal to the sender's id on the receiving server's message.
          UpdatedMessage:
            description: Updated message details.
            type: object
            required: true
            properties: *editMessageRequestBody
      responses:
        200:
          description: Message edited successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. Requesting server's JWT is not valid (JWT iss domain != sender id domain), or user does not have permission to edit the message, or Receiving server is not conversation owner's server.
        404:
          description: Conversation or message not found.
        500:
          description: Internal server error while editing the message from federation request.

    FetchAttachmentBytesFederation:
      path: /api/federation/conversations/{conversationId}/messages/{messageId}/attachments/{attachmentId}/bytes
      method: GET
      description: \"FEDERATION\" Fetch the bytes of an attachment from another server. This is a noop endpoint for documentation purposes, the server should implement fetching the actual bytes using the provided endpoint. Server must implement this, requesting server needs to fetch the bytes NOT using the SDK.
      auth:
        all:
          - serverToken
      pathParams:
        - name: AttachmentId
          transportName: attachmentId
          type: string
          required: true
          description: Unique identifier of the attachment to fetch.
        - name: MessageId
          transportName: messageId
          type: string
          required: true
          description: Unique identifier of the message that the attachment belongs to.
        - name: ConversationId
          transportName: conversationId
          type: string
          required: true
          description: Unique identifier of the conversation that the message belongs to.
      responses:
        200:
          description: Attachment bytes fetched successfully from federation request.
        400:
          description: Invalid input data.
        401:
          description: Unauthorized. No valid server token provided.
        403:
          description: Forbidden. The requesting server is not allowed to access the attachment.
        404:
          description: Conversation, message, or attachment not found, or the attachment does not belong to the message or the message does not belong to the conversation specified in the path parameters.
        500:
          description: Internal server error while fetching the attachment bytes from federation request.
